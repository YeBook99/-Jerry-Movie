<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ss.cinema.mappers.PaymentMapper">


<insert id="insertPayment" parameterType="com.ss.cinema.dto.PaymentDTO">
        INSERT INTO PAYMENT (PAYMENT_TYPE, PAYMENT_DATE, PAYMENT_PRICE, PAYMENT_IMP_UID)
        VALUES (#{paymentType}, #{paymentDate}, #{paymentPrice}, #{paymentImpUid})
    </insert>

    <!-- IMP_UID로 결제 내역 조회 -->
    <select id="selectPaymentByImpUid" resultType="com.ss.cinema.dto.PaymentDTO">
        SELECT PAYMENT_NO, PAYMENT_TYPE, PAYMENT_DATE, PAYMENT_PRICE, PAYMENT_IMP_UID
        FROM PAYMENT
        WHERE PAYMENT_IMP_UID = #{impUid}
    </select>

    <!-- 결제 내역 ID로 결제 정보 조회 -->
    <select id="selectPaymentById" resultType="com.ss.cinema.dto.PaymentDTO">
        SELECT PAYMENT_NO, PAYMENT_TYPE, PAYMENT_DATE, PAYMENT_PRICE, PAYMENT_IMP_UID
        FROM PAYMENT
        WHERE PAYMENT_NO = #{paymentNo}
    </select>

    <!-- 결제 내역 ID로 결제된 상품 리스트 조회 -->
    <select id="selectPaymentProductsByPaymentNo" resultType="com.ss.cinema.dto.JunPaymentProductDTO">
        SELECT PAYMENT_PRODUCT_NO, PAYMENT_PRODUCT_PAYMENT_NO, PAYMENT_PRODUCT_BASKET_NO
        FROM PAYMENT_PRODUCT
        WHERE PAYMENT_PRODUCT_PAYMENT_NO = #{paymentNo}
    </select>

    <!-- 제품 결제 내역 삽입 -->
    <insert id="insertPaymentProduct" parameterType="com.ss.cinema.dto.JunPaymentProductDTO">
        INSERT INTO PAYMENT_PRODUCT (PAYMENT_PRODUCT_PAYMENT_NO, PAYMENT_PRODUCT_BASKET_NO)
        VALUES (#{paymentProductPaymentNo}, #{paymentProductBasketNo})
    </insert>

    <!-- 장바구니 상태 업데이트 -->
    <update id="updateBasketStatus">
        UPDATE BASKET
        SET BASKET_STATUS = #{status}
        WHERE BASKET_NO = #{basketNo}
    </update>




</mapper>
